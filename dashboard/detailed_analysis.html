<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç GR Cup Detailed Analysis Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #eb0a1e, #c41e3a);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .header h1 {
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            transition: background 0.3s;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .selection-bar {
            background: #1a1a1a;
            padding: 20px;
            border-bottom: 1px solid #333;
        }
        
        .selection-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .selector {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .selector h3 {
            color: #eb0a1e;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .selector select {
            width: 100%;
            background: #333;
            color: white;
            border: 1px solid #eb0a1e;
            padding: 10px;
            border-radius: 4px;
            font-size: 1em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .panel {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #333;
        }
        
        .panel h2 {
            color: #eb0a1e;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #eb0a1e;
            padding-bottom: 8px;
        }
        
        .full-width {
            grid-column: 1 / 3;
        }
        
        .telemetry-chart {
            height: 300px;
            background: #2a2a2a;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
        }
        
        .chart-placeholder {
            color: #666;
            font-size: 1.1em;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-box {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #eb0a1e;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #eb0a1e;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .metric-change {
            font-size: 0.8em;
            margin-top: 5px;
        }
        
        .change-positive { color: #00ff00; }
        .change-negative { color: #ff4444; }
        .change-neutral { color: #ffaa00; }
        
        .detailed-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .detailed-table th,
        .detailed-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        .detailed-table th {
            background: #2a2a2a;
            color: #eb0a1e;
            font-weight: bold;
        }
        
        .detailed-table tr:hover {
            background: #2a2a2a;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #eb0a1e, #ff6b35);
            transition: width 0.3s ease;
        }
        
        .insight-card {
            background: #2a2a2a;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #eb0a1e;
        }
        
        .insight-card.critical {
            border-left-color: #ff0000;
            background: #3a1a1a;
        }
        
        .insight-card.warning {
            border-left-color: #ffaa00;
            background: #3a2a1a;
        }
        
        .insight-card.positive {
            border-left-color: #00ff00;
            background: #1a3a1a;
        }
        
        .insight-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1em;
        }
        
        .insight-detail {
            font-size: 0.9em;
            line-height: 1.4;
            opacity: 0.9;
        }
        
        .comparison-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .comparison-card {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 6px;
        }
        
        .comparison-title {
            color: #eb0a1e;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .track-map-container {
            width: 100%;
            height: 250px;
            background: #0a0a0a;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
        }
        
        .track-image {
            max-width: 100%;
            max-height: 100%;
            border-radius: 6px;
            object-fit: contain;
        }
        
        .sector-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>üîç GR Cup Detailed Analysis</h1>
            <div style="font-size: 0.8em; opacity: 0.8;">Deep Dive Performance Analysis</div>
        </div>
        <div class="nav-links">
            <a href="track_dashboard.html" class="nav-link">‚Üê Main Dashboard</a>
            <a href="#" class="nav-link" onclick="exportData()">üìä Export Data</a>
        </div>
    </div>
    
    <div class="selection-bar">
        <div class="selection-grid">
            <div class="selector">
                <h3>üèéÔ∏è Select Driver</h3>
                <select id="driverSelector">
                    <option value="">Choose a driver...</option>
                    <option value="001">Driver #001 - GR86-001-001</option>
                    <option value="002">Driver #002 - GR86-002-002</option>
                    <option value="003">Driver #003 - GR86-003-003</option>
                    <option value="004">Driver #004 - GR86-004-004</option>
                    <option value="005">Driver #005 - GR86-005-005</option>
                </select>
            </div>
            
            <div class="selector">
                <h3>üó∫Ô∏è Select Track</h3>
                <select id="trackSelector">
                    <option value="">Choose a track...</option>
                    <option value="BMP">Barber Motorsports Park</option>
                    <option value="COTA">Circuit of the Americas</option>
                    <option value="VIR">Virginia International Raceway</option>
                    <option value="SEB">Sebring International Raceway</option>
                    <option value="SON">Sonoma Raceway</option>
                    <option value="RA">Road America</option>
                    <option value="INDY">Indianapolis Motor Speedway</option>
                </select>
            </div>
            
            <div class="selector">
                <h3>üìä Analysis Type</h3>
                <select id="analysisSelector">
                    <option value="overview">Performance Overview</option>
                    <option value="telemetry">Telemetry Deep Dive</option>
                    <option value="comparison">Driver Comparison</option>
                    <option value="historical">Historical Trends</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="main-content" id="mainContent">
        <div class="loading">
            <h2>Select a driver and track to begin detailed analysis</h2>
            <p>Choose from the dropdowns above to see comprehensive performance insights</p>
        </div>
    </div>
    
    <script src="track_images_embedded.js"></script>
    <script>
        // Complete driver data structure - imported from main dashboard
        // Note: This should match the data in track_dashboard.html
        const driverData = {
            "001": { name: "Driver #001", chassis: "GR86-001-001", status: "fast", tracks: { "BMP": { bestLap: "1:24.567", avgSpeed: 142.3, consistency: 94, position: 3, sectors: [23.456, 31.234, 29.877, 25.123, 28.456, 26.421], gearUsage: { gear2: 15, gear3: 25, gear4: 35, gear5: 20, gear6: 5 }, avgGear: 4.2, maxGear: 6, gearShifts: 28 }, "COTA": { bestLap: "2:18.234", avgSpeed: 138.7, consistency: 91, position: 4, sectors: [28.456, 42.123, 35.877, 32.123, 31.456, 28.199], gearUsage: { gear2: 8, gear3: 18, gear4: 28, gear5: 32, gear6: 14 }, avgGear: 4.8, maxGear: 6, gearShifts: 35 }, "VIR": { bestLap: "2:05.789", avgSpeed: 145.2, consistency: 96, position: 2, sectors: [25.789, 38.456, 32.123, 29.421, 30.000, 29.000], gearUsage: { gear2: 5, gear3: 15, gear4: 30, gear5: 35, gear6: 15 }, avgGear: 5.1, maxGear: 6, gearShifts: 22 }, "SEB": { bestLap: "2:45.234", avgSpeed: 139.8, consistency: 93, position: 3, sectors: [32.456, 48.123, 41.789, 35.234, 38.456, 29.176], gearUsage: { gear2: 8, gear3: 18, gear4: 32, gear5: 28, gear6: 14 }, avgGear: 4.7, maxGear: 6, gearShifts: 28 }, "SON": { bestLap: "1:52.567", avgSpeed: 137.4, consistency: 91, position: 4, sectors: [28.567, 35.123, 31.456, 17.421], gearUsage: { gear2: 12, gear3: 25, gear4: 35, gear5: 23, gear6: 5 }, avgGear: 4.3, maxGear: 6, gearShifts: 24 }, "RA": { bestLap: "2:28.789", avgSpeed: 148.2, consistency: 94, position: 2, sectors: [35.789, 52.123, 43.456, 37.421], gearUsage: { gear2: 4, gear3: 12, gear4: 25, gear5: 35, gear6: 24 }, avgGear: 5.3, maxGear: 6, gearShifts: 18 }, "INDY": { bestLap: "1:45.123", avgSpeed: 152.8, consistency: 97, position: 2, sectors: [26.123, 26.000, 26.500, 26.500], gearUsage: { gear2: 0, gear3: 2, gear4: 8, gear5: 25, gear6: 65 }, avgGear: 5.8, maxGear: 6, gearShifts: 8 } } },
            "002": { name: "Driver #002", chassis: "GR86-002-002", status: "fast", tracks: { "BMP": { bestLap: "1:23.234", avgSpeed: 145.7, consistency: 97, position: 1, sectors: [22.987, 30.456, 29.234, 24.789, 27.987, 25.781], gearUsage: { gear2: 12, gear3: 22, gear4: 38, gear5: 23, gear6: 5 }, avgGear: 4.3, maxGear: 6, gearShifts: 26 }, "COTA": { bestLap: "2:16.123", avgSpeed: 142.1, consistency: 95, position: 1, sectors: [27.123, 41.234, 34.567, 31.456, 30.789, 27.954], gearUsage: { gear2: 6, gear3: 16, gear4: 26, gear5: 36, gear6: 16 }, avgGear: 5.0, maxGear: 6, gearShifts: 32 }, "VIR": { bestLap: "2:03.456", avgSpeed: 147.8, consistency: 98, position: 1, sectors: [24.456, 37.123, 31.234, 28.789, 29.123, 28.731], gearUsage: { gear2: 3, gear3: 12, gear4: 28, gear5: 38, gear6: 19 }, avgGear: 5.2, maxGear: 6, gearShifts: 20 }, "SEB": { bestLap: "2:42.123", avgSpeed: 142.5, consistency: 96, position: 1, sectors: [31.123, 47.234, 40.567, 34.123, 37.234, 28.842], gearUsage: { gear2: 6, gear3: 16, gear4: 30, gear5: 32, gear6: 16 }, avgGear: 4.9, maxGear: 6, gearShifts: 25 }, "SON": { bestLap: "1:50.234", avgSpeed: 140.8, consistency: 97, position: 1, sectors: [27.234, 34.123, 30.456, 16.421], gearUsage: { gear2: 10, gear3: 22, gear4: 38, gear5: 25, gear6: 5 }, avgGear: 4.5, maxGear: 6, gearShifts: 22 }, "RA": { bestLap: "2:25.456", avgSpeed: 151.2, consistency: 98, position: 1, sectors: [34.456, 50.789, 42.123, 36.088], gearUsage: { gear2: 3, gear3: 10, gear4: 22, gear5: 38, gear6: 27 }, avgGear: 5.5, maxGear: 6, gearShifts: 16 }, "INDY": { bestLap: "1:43.789", avgSpeed: 155.2, consistency: 99, position: 1, sectors: [25.789, 25.500, 26.000, 26.500], gearUsage: { gear2: 0, gear3: 1, gear4: 5, gear5: 22, gear6: 72 }, avgGear: 5.9, maxGear: 6, gearShifts: 6 } } },
            "003": { name: "Driver #003", chassis: "GR86-003-003", status: "struggling", tracks: { "BMP": { bestLap: "1:26.123", avgSpeed: 138.9, consistency: 87, position: 8, sectors: [24.123, 32.456, 31.234, 26.789, 29.876, 27.645], gearUsage: { gear2: 20, gear3: 30, gear4: 28, gear5: 18, gear6: 4 }, avgGear: 3.8, maxGear: 6, gearShifts: 35 }, "COTA": { bestLap: "2:22.789", avgSpeed: 135.2, consistency: 83, position: 7, sectors: [29.789, 44.123, 37.456, 33.789, 32.876, 29.756], gearUsage: { gear2: 15, gear3: 25, gear4: 32, gear5: 23, gear6: 5 }, avgGear: 4.1, maxGear: 6, gearShifts: 42 }, "VIR": { bestLap: "2:09.456", avgSpeed: 140.1, consistency: 89, position: 6, sectors: [26.456, 40.123, 33.789, 30.456, 31.234, 30.398], gearUsage: { gear2: 8, gear3: 20, gear4: 35, gear5: 28, gear6: 9 }, avgGear: 4.5, maxGear: 6, gearShifts: 28 }, "SEB": { bestLap: "2:49.789", avgSpeed: 135.2, consistency: 84, position: 7, sectors: [33.789, 50.123, 43.456, 36.789, 39.876, 30.756], gearUsage: { gear2: 12, gear3: 25, gear4: 32, gear5: 23, gear6: 8 }, avgGear: 4.3, maxGear: 6, gearShifts: 38 }, "SON": { bestLap: "1:55.789", avgSpeed: 133.8, consistency: 82, position: 8, sectors: [30.789, 37.123, 33.456, 18.421], gearUsage: { gear2: 18, gear3: 30, gear4: 32, gear5: 18, gear6: 2 }, avgGear: 3.9, maxGear: 6, gearShifts: 35 }, "RA": { bestLap: "2:34.567", avgSpeed: 143.1, consistency: 86, position: 7, sectors: [37.567, 55.123, 45.456, 39.421], gearUsage: { gear2: 6, gear3: 18, gear4: 35, gear5: 28, gear6: 13 }, avgGear: 4.6, maxGear: 6, gearShifts: 32 }, "INDY": { bestLap: "1:48.456", avgSpeed: 149.2, consistency: 88, position: 6, sectors: [27.456, 27.000, 27.000, 27.000], gearUsage: { gear2: 0, gear3: 5, gear4: 15, gear5: 35, gear6: 45 }, avgGear: 5.4, maxGear: 6, gearShifts: 12 } } },
            "004": { name: "Driver #004", chassis: "GR86-004-004", status: "needs-attention", tracks: { "BMP": { bestLap: "1:25.789", avgSpeed: 140.2, consistency: 91, position: 5, sectors: [23.789, 31.876, 30.123, 25.456, 28.789, 26.756], gearUsage: { gear2: 18, gear3: 28, gear4: 32, gear5: 19, gear6: 3 }, avgGear: 4.0, maxGear: 6, gearShifts: 31 }, "COTA": { bestLap: "2:20.456", avgSpeed: 137.8, consistency: 88, position: 6, sectors: [28.789, 43.456, 36.123, 32.789, 31.876, 28.423], gearUsage: { gear2: 10, gear3: 20, gear4: 30, gear5: 30, gear6: 10 }, avgGear: 4.6, maxGear: 6, gearShifts: 38 }, "VIR": { bestLap: "2:07.123", avgSpeed: 143.5, consistency: 93, position: 4, sectors: [25.123, 38.789, 32.456, 29.789, 30.456, 29.510], gearUsage: { gear2: 6, gear3: 16, gear4: 32, gear5: 32, gear6: 14 }, avgGear: 4.9, maxGear: 6, gearShifts: 25 }, "SEB": { bestLap: "2:47.456", avgSpeed: 137.8, consistency: 90, position: 5, sectors: [32.456, 49.123, 42.789, 35.456, 38.789, 29.843], gearUsage: { gear2: 10, gear3: 20, gear4: 30, gear5: 28, gear6: 12 }, avgGear: 4.6, maxGear: 6, gearShifts: 30 }, "SON": { bestLap: "1:53.456", avgSpeed: 136.2, consistency: 89, position: 6, sectors: [29.456, 36.123, 32.456, 17.421], gearUsage: { gear2: 14, gear3: 26, gear4: 34, gear5: 22, gear6: 4 }, avgGear: 4.2, maxGear: 6, gearShifts: 28 }, "RA": { bestLap: "2:30.789", avgSpeed: 146.5, consistency: 92, position: 4, sectors: [36.789, 53.123, 44.456, 38.421], gearUsage: { gear2: 5, gear3: 14, gear4: 28, gear5: 33, gear6: 20 }, avgGear: 5.1, maxGear: 6, gearShifts: 22 }, "INDY": { bestLap: "1:46.789", avgSpeed: 151.8, consistency: 94, position: 4, sectors: [26.789, 26.500, 26.500, 27.000], gearUsage: { gear2: 0, gear3: 3, gear4: 10, gear5: 27, gear6: 60 }, avgGear: 5.7, maxGear: 6, gearShifts: 10 } } },
            "005": { name: "Driver #005", chassis: "GR86-005-005", status: "needs-attention", tracks: { "BMP": { bestLap: "1:25.234", avgSpeed: 141.8, consistency: 89, position: 6, sectors: [23.234, 31.567, 30.456, 25.789, 28.234, 26.954], gearUsage: { gear2: 16, gear3: 26, gear4: 34, gear5: 20, gear6: 4 }, avgGear: 4.1, maxGear: 6, gearShifts: 33 }, "COTA": { bestLap: "2:21.567", avgSpeed: 136.4, consistency: 86, position: 8, sectors: [29.234, 43.789, 36.567, 33.234, 32.123, 29.620], gearUsage: { gear2: 12, gear3: 22, gear4: 28, gear5: 28, gear6: 10 }, avgGear: 4.4, maxGear: 6, gearShifts: 40 }, "VIR": { bestLap: "2:08.789", avgSpeed: 142.1, consistency: 91, position: 5, sectors: [25.789, 39.234, 33.123, 30.234, 30.789, 29.620], gearUsage: { gear2: 7, gear3: 18, gear4: 30, gear5: 30, gear6: 15 }, avgGear: 4.7, maxGear: 6, gearShifts: 26 }, "SEB": { bestLap: "2:48.567", avgSpeed: 136.4, consistency: 87, position: 6, sectors: [33.567, 49.789, 43.123, 36.234, 39.234, 30.620], gearUsage: { gear2: 11, gear3: 22, gear4: 31, gear5: 26, gear6: 10 }, avgGear: 4.5, maxGear: 6, gearShifts: 32 }, "SON": { bestLap: "1:54.234", avgSpeed: 135.6, consistency: 85, position: 7, sectors: [30.234, 36.789, 32.789, 18.422], gearUsage: { gear2: 15, gear3: 28, gear4: 33, gear5: 20, gear6: 4 }, avgGear: 4.1, maxGear: 6, gearShifts: 30 }, "RA": { bestLap: "2:32.234", avgSpeed: 145.1, consistency: 90, position: 5, sectors: [37.234, 54.123, 45.123, 39.754], gearUsage: { gear2: 6, gear3: 16, gear4: 30, gear5: 30, gear6: 18 }, avgGear: 4.9, maxGear: 6, gearShifts: 26 }, "INDY": { bestLap: "1:47.567", avgSpeed: 150.4, consistency: 92, position: 5, sectors: [27.567, 26.800, 26.700, 27.500], gearUsage: { gear2: 0, gear3: 4, gear4: 12, gear5: 29, gear6: 55 }, avgGear: 5.6, maxGear: 6, gearShifts: 12 } } }
        };
        
        const trackConfigs = {
            'BMP': { name: 'Barber Motorsports Park', length: '2.4 km', corners: 17, sectors: 6, characteristics: ['Technical', 'Flowing', 'Elevation Changes'] },
            'COTA': { name: 'Circuit of the Americas', length: '5.5 km', corners: 20, sectors: 6, characteristics: ['Mixed', 'High-Speed', 'Technical Sections'] },
            'VIR': { name: 'Virginia International Raceway', length: '5.2 km', corners: 23, sectors: 6, characteristics: ['High-Speed', 'Flowing', 'Uphill Esses'] },
            'SEB': { name: 'Sebring International Raceway', length: '6.0 km', corners: 17, sectors: 6, characteristics: ['Bumpy', 'Technical', 'Abrasive Surface'] },
            'SON': { name: 'Sonoma Raceway', length: '4.0 km', corners: 12, sectors: 4, characteristics: ['Elevation', 'Technical', 'Carousel'] },
            'RA': { name: 'Road America', length: '6.5 km', corners: 14, sectors: 4, characteristics: ['High-Speed', 'Long Straights', 'The Kink'] },
            'INDY': { name: 'Indianapolis Motor Speedway', length: '4.0 km', corners: 4, sectors: 4, characteristics: ['Oval', 'High-Speed', 'Draft Strategy'] }
        };
        
        let selectedDriver = null;
        let selectedTrack = null;
        let analysisType = 'overview';
        
        function initializeDetailedDashboard() {
            console.log("Initializing Detailed Analysis Dashboard");
            
            // Check for URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const driverParam = urlParams.get('driver');
            const trackParam = urlParams.get('track');
            
            // Set initial selections from URL parameters
            if (driverParam) {
                selectedDriver = driverParam;
                document.getElementById('driverSelector').value = driverParam;
            }
            
            if (trackParam) {
                selectedTrack = trackParam;
                document.getElementById('trackSelector').value = trackParam;
            }
            
            // Set up event listeners
            document.getElementById('driverSelector').addEventListener('change', function() {
                selectedDriver = this.value;
                updateAnalysis();
            });
            
            document.getElementById('trackSelector').addEventListener('change', function() {
                selectedTrack = this.value;
                updateAnalysis();
            });
            
            document.getElementById('analysisSelector').addEventListener('change', function() {
                analysisType = this.value;
                updateAnalysis();
            });
            
            // Initial analysis if both driver and track are selected
            if (selectedDriver && selectedTrack) {
                updateAnalysis();
            }
        }
        
        function updateAnalysis() {
            const mainContent = document.getElementById('mainContent');
            
            if (!selectedDriver || !selectedTrack) {
                mainContent.innerHTML = `
                    <div class="loading">
                        <h2>Select both a driver and track to begin analysis</h2>
                        <p>Choose from the dropdowns above to see comprehensive performance insights</p>
                    </div>
                `;
                return;
            }
            
            const driver = driverData[selectedDriver];
            const trackData = driver?.tracks[selectedTrack];
            const trackConfig = trackConfigs[selectedTrack];
            
            if (!trackData) {
                mainContent.innerHTML = `
                    <div class="loading">
                        <h2>No data available</h2>
                        <p>No performance data found for ${driver?.name} at ${trackConfig?.name}</p>
                    </div>
                `;
                return;
            }
            
            switch(analysisType) {
                case 'overview':
                    renderOverviewAnalysis(driver, trackData, trackConfig);
                    break;
                case 'telemetry':
                    renderTelemetryAnalysis(driver, trackData, trackConfig);
                    break;
                case 'comparison':
                    renderComparisonAnalysis(driver, trackData, trackConfig);
                    break;
                case 'historical':
                    renderHistoricalAnalysis(driver, trackData, trackConfig);
                    break;
            }
        }
        
        function renderOverviewAnalysis(driver, trackData, trackConfig) {
            const mainContent = document.getElementById('mainContent');
            
            mainContent.innerHTML = `
                <!-- Performance Overview -->
                <div class="panel">
                    <h2>üìä Performance Overview</h2>
                    <h3 style="color: #eb0a1e; margin-bottom: 15px;">${driver.name} at ${trackConfig.name}</h3>
                    
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-value">${trackData.bestLap}</div>
                            <div class="metric-label">Best Lap Time</div>
                            <div class="metric-change change-positive">-0.234s vs last session</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">P${trackData.position}</div>
                            <div class="metric-label">Current Position</div>
                            <div class="metric-change change-positive">+1 position gained</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${trackData.avgSpeed}</div>
                            <div class="metric-label">Avg Speed (mph)</div>
                            <div class="metric-change change-positive">+2.1 mph improvement</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${trackData.consistency}%</div>
                            <div class="metric-label">Consistency</div>
                            <div class="metric-change change-neutral">Stable</div>
                        </div>
                    </div>
                    
                    <h4 style="color: #eb0a1e; margin: 20px 0 10px 0;">Sector Performance</h4>
                    <table class="detailed-table">
                        <thead>
                            <tr>
                                <th>Sector</th>
                                <th>Time</th>
                                <th>vs Best</th>
                                <th>Rank</th>
                                <th>Improvement</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${trackData.sectors.map((time, index) => {
                                const bestSector = Math.min(...trackData.sectors);
                                const delta = time - bestSector;
                                return `
                                    <tr>
                                        <td>Sector ${index + 1}</td>
                                        <td>${time.toFixed(3)}s</td>
                                        <td style="color: ${delta === 0 ? '#00ff00' : '#ffaa00'}">${delta === 0 ? 'BEST' : '+' + delta.toFixed(3) + 's'}</td>
                                        <td>${Math.floor(Math.random() * 5) + 1}/5</td>
                                        <td style="color: #00ff00">-0.${Math.floor(Math.random() * 200) + 50}s</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                
                <!-- Track Analysis -->
                <div class="panel">
                    <h2>üó∫Ô∏è Track Analysis</h2>
                    
                    <div class="track-map-container">
                        <img id="trackImage" class="track-image" src="" alt="Track Layout" />
                    </div>
                    
                    <h4 style="color: #eb0a1e; margin-bottom: 10px;">Track Characteristics</h4>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        ${trackConfig.characteristics.map(char => 
                            `<span style="background: #2a2a2a; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">${char}</span>`
                        ).join('')}
                    </div>
                    
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-value">${trackConfig.length}</div>
                            <div class="metric-label">Track Length</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${trackConfig.corners}</div>
                            <div class="metric-label">Total Corners</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${trackConfig.sectors}</div>
                            <div class="metric-label">Sectors</div>
                        </div>
                    </div>
                </div>
                
                <!-- Gear Analysis -->
                <div class="panel full-width">
                    <h2>‚öôÔ∏è Detailed Gear Analysis</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: #eb0a1e; margin-bottom: 10px;">Gear Usage Distribution</h4>
                            <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 10px;">
                                Shows percentage of lap time spent in each gear. Optimal distribution varies by track type.
                            </p>
                            ${generateDetailedGearChart(trackData.gearUsage)}
                            
                            <div style="background: #333; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 0.85em;">
                                <strong>Reading the chart:</strong><br>
                                ‚Ä¢ <span style="color: #ff4444;">Red (1st-2nd)</span>: Low speed corners, should be minimal<br>
                                ‚Ä¢ <span style="color: #ffaa44;">Yellow (3rd-4th)</span>: Technical sections, most common<br>
                                ‚Ä¢ <span style="color: #44ff88;">Green (5th-6th)</span>: High speed sections, maximize for speed
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #eb0a1e; margin-bottom: 10px;">Gear Performance Metrics</h4>
                            <div class="metrics-grid">
                                <div class="metric-box">
                                    <div class="metric-value">${trackData.avgGear}</div>
                                    <div class="metric-label">Average Gear</div>
                                    <div class="metric-change ${trackData.avgGear >= 4.5 ? 'change-positive' : trackData.avgGear >= 4.0 ? 'change-neutral' : 'change-negative'}">
                                        ${trackData.avgGear >= 4.5 ? 'Optimal' : trackData.avgGear >= 4.0 ? 'Good' : 'Needs Work'}
                                    </div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-value">${trackData.gearShifts}</div>
                                    <div class="metric-label">Shifts per Lap</div>
                                    <div class="metric-change ${trackData.gearShifts <= 25 ? 'change-positive' : trackData.gearShifts <= 35 ? 'change-neutral' : 'change-negative'}">
                                        ${trackData.gearShifts <= 25 ? 'Excellent' : trackData.gearShifts <= 35 ? 'Good' : 'Too Many'}
                                    </div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-value">${trackData.maxGear}</div>
                                    <div class="metric-label">Max Gear Used</div>
                                    <div class="metric-change ${trackData.maxGear === 6 ? 'change-positive' : 'change-negative'}">
                                        ${trackData.maxGear === 6 ? 'Full Range' : 'Limited'}
                                    </div>
                                </div>
                                <div class="metric-box">
                                    <div class="metric-value">${calculateGearScore(trackData)}%</div>
                                    <div class="metric-label">Gear Efficiency</div>
                                    <div class="metric-change ${calculateGearScore(trackData) >= 85 ? 'change-positive' : calculateGearScore(trackData) >= 70 ? 'change-neutral' : 'change-negative'}">
                                        ${calculateGearScore(trackData) >= 85 ? 'Excellent' : calculateGearScore(trackData) >= 70 ? 'Good' : 'Needs Work'}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #2a2a2a; padding: 12px; border-radius: 6px; margin-top: 15px; font-size: 0.9em;">
                                <strong>Gear Efficiency Explained:</strong><br>
                                Combines average gear usage, shift frequency, and gear range utilization. 
                                Higher scores indicate better gear management and potential for faster lap times.
                                <br><br>
                                <strong>Improvement Priority:</strong><br>
                                ${getGearImprovementPriority(trackData)}
                            </div>
                            
                            <h4 style="color: #eb0a1e; margin: 15px 0 10px 0;">Gear Optimization</h4>
                            ${generateGearRecommendations(trackData)}
                        </div>
                    </div>
                </div>
                
                <!-- Coaching Insights -->
                <div class="panel full-width">
                    <h2>üéØ Advanced Coaching Insights</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        ${generateAdvancedInsights(driver, trackData, trackConfig)}
                    </div>
                </div>
            `;
            
            // Load track image
            loadTrackImage(selectedTrack);
        }
        
        function renderTelemetryAnalysis(driver, trackData, trackConfig) {
            const mainContent = document.getElementById('mainContent');
            
            // Generate simulated telemetry data
            const maxSpeed = 140 + Math.random() * 30;
            const avgThrottle = 60 + Math.random() * 15;
            const maxCorneringG = 1.5 + Math.random() * 0.5;
            const maxBrakingG = 1.8 + Math.random() * 0.5;
            
            mainContent.innerHTML = `
                <div class="panel full-width">
                    <h2>üìà Telemetry Deep Dive - ${driver.name} at ${trackConfig.name}</h2>
                    <p style="margin-bottom: 20px; opacity: 0.8;">Comprehensive telemetry analysis showing speed, throttle, braking, and G-force patterns throughout the lap</p>
                    
                    <div class="telemetry-chart">
                        ${generateSpeedChart(trackData)}
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-title">üìä Speed Analysis</div>
                        <div class="insight-detail">
                            <strong>Peak Speed:</strong> ${maxSpeed.toFixed(1)} mph achieved on main straight<br>
                            <strong>Minimum Speed:</strong> ${(maxSpeed * 0.3).toFixed(1)} mph in slowest corner<br>
                            <strong>Speed Variance:</strong> ${trackData.consistency}% consistency indicates ${trackData.consistency > 90 ? 'excellent' : 'good'} speed control<br>
                            <strong>Coaching:</strong> ${trackData.consistency < 90 ? 'Focus on consistent corner entry speeds and throttle application' : 'Maintain current speed consistency, look for micro-optimizations'}
                        </div>
                    </div>
                    
                    <div class="telemetry-chart">
                        ${generateThrottleBrakeChart(trackData)}
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-title">üéÆ Throttle & Brake Analysis</div>
                        <div class="insight-detail">
                            <strong>Average Throttle:</strong> ${avgThrottle.toFixed(1)}% - ${avgThrottle > 70 ? 'Aggressive' : avgThrottle > 60 ? 'Balanced' : 'Conservative'} driving style<br>
                            <strong>Braking Zones:</strong> ${trackConfig.corners} major braking points identified<br>
                            <strong>Trail Braking:</strong> ${Math.random() > 0.5 ? 'Good overlap between brake and throttle' : 'Opportunity to improve trail braking technique'}<br>
                            <strong>Coaching:</strong> ${avgThrottle < 65 ? 'Work on earlier throttle application out of corners' : 'Good throttle usage, focus on smoothness'}
                        </div>
                    </div>
                    
                    <div class="telemetry-chart">
                        ${generateGForceChart(trackData)}
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-title">üåÄ G-Force Analysis</div>
                        <div class="insight-detail">
                            <strong>Max Cornering G:</strong> ${maxCorneringG.toFixed(2)}G - ${maxCorneringG > 1.8 ? 'Excellent' : maxCorneringG > 1.5 ? 'Good' : 'Moderate'} cornering forces<br>
                            <strong>Max Braking G:</strong> ${maxBrakingG.toFixed(2)}G - ${maxBrakingG > 2.0 ? 'Strong' : 'Adequate'} braking performance<br>
                            <strong>Balance:</strong> ${Math.abs(maxCorneringG - 1.7) < 0.2 ? 'Well-balanced car setup' : 'Consider setup adjustments'}<br>
                            <strong>Coaching:</strong> ${maxCorneringG < 1.6 ? 'Work on carrying more speed through corners' : 'Good cornering speed, maintain technique'}
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>üîß Technical Metrics</h2>
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-value">${maxSpeed.toFixed(1)}</div>
                            <div class="metric-label">Max Speed (mph)</div>
                            <div class="metric-change ${maxSpeed > 160 ? 'change-positive' : 'change-neutral'}">
                                ${maxSpeed > 160 ? 'Excellent' : 'Good'}
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${avgThrottle.toFixed(1)}%</div>
                            <div class="metric-label">Avg Throttle</div>
                            <div class="metric-change ${avgThrottle > 70 ? 'change-positive' : 'change-neutral'}">
                                ${avgThrottle > 70 ? 'Aggressive' : 'Balanced'}
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${maxCorneringG.toFixed(2)}G</div>
                            <div class="metric-label">Max Cornering</div>
                            <div class="metric-change ${maxCorneringG > 1.7 ? 'change-positive' : 'change-neutral'}">
                                ${maxCorneringG > 1.7 ? 'Strong' : 'Moderate'}
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${maxBrakingG.toFixed(2)}G</div>
                            <div class="metric-label">Max Braking</div>
                            <div class="metric-change ${maxBrakingG > 2.0 ? 'change-positive' : 'change-neutral'}">
                                ${maxBrakingG > 2.0 ? 'Excellent' : 'Good'}
                            </div>
                        </div>
                    </div>
                    
                    <h4 style="color: #eb0a1e; margin: 20px 0 10px 0;">Telemetry Insights</h4>
                    ${generateTelemetryInsights(trackData, maxSpeed, avgThrottle, maxCorneringG)}
                </div>
                
                <div class="panel">
                    <h2>üå°Ô∏è Vehicle Data</h2>
                    <h4 style="color: #eb0a1e; margin-bottom: 10px;">Tire Temperatures</h4>
                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-value">${(95 + Math.random() * 10).toFixed(0)}¬∞F</div>
                            <div class="metric-label">Front Left</div>
                            <div class="metric-change change-positive">Optimal</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${(98 + Math.random() * 10).toFixed(0)}¬∞F</div>
                            <div class="metric-label">Front Right</div>
                            <div class="metric-change change-positive">Optimal</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${(92 + Math.random() * 10).toFixed(0)}¬∞F</div>
                            <div class="metric-label">Rear Left</div>
                            <div class="metric-change change-positive">Good</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${(96 + Math.random() * 10).toFixed(0)}¬∞F</div>
                            <div class="metric-label">Rear Right</div>
                            <div class="metric-change change-positive">Good</div>
                        </div>
                    </div>
                    
                    <div class="insight-card" style="margin-top: 15px;">
                        <div class="insight-title">üî• Tire Temperature Analysis</div>
                        <div class="insight-detail">
                            <strong>Overall Balance:</strong> Good temperature distribution across all tires<br>
                            <strong>Front vs Rear:</strong> Balanced setup with proper weight transfer<br>
                            <strong>Left vs Right:</strong> Minimal temperature difference indicates good track balance<br>
                            <strong>Recommendation:</strong> Current tire pressures are optimal for this track
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateSpeedChart(trackData) {
            return `
                <div style="background: #2a2a2a; padding: 20px; border-radius: 6px; height: 250px; position: relative;">
                    <div style="color: #eb0a1e; font-weight: bold; margin-bottom: 10px;">Speed vs Distance</div>
                    <svg width="100%" height="200" viewBox="0 0 800 200">
                        <!-- Speed trace -->
                        <polyline points="${generateSpeedTrace()}" 
                                  fill="none" stroke="#00ff00" stroke-width="2"/>
                        <!-- Grid lines -->
                        <line x1="0" y1="50" x2="800" y2="50" stroke="#333" stroke-width="1"/>
                        <line x1="0" y1="100" x2="800" y2="100" stroke="#333" stroke-width="1"/>
                        <line x1="0" y1="150" x2="800" y2="150" stroke="#333" stroke-width="1"/>
                        <!-- Labels -->
                        <text x="10" y="20" fill="#666" font-size="12">High Speed</text>
                        <text x="10" y="190" fill="#666" font-size="12">Low Speed</text>
                        <text x="750" y="190" fill="#666" font-size="12">Lap Distance</text>
                    </svg>
                    <div style="font-size: 0.85em; opacity: 0.7; margin-top: 10px;">
                        Green line shows speed variation throughout the lap. Peaks = straights, valleys = corners
                    </div>
                </div>
            `;
        }
        
        function generateThrottleBrakeChart(trackData) {
            return `
                <div style="background: #2a2a2a; padding: 20px; border-radius: 6px; height: 250px; position: relative;">
                    <div style="color: #eb0a1e; font-weight: bold; margin-bottom: 10px;">Throttle (Green) & Brake (Red) Application</div>
                    <svg width="100%" height="200" viewBox="0 0 800 200">
                        <!-- Throttle trace -->
                        <polyline points="${generateThrottleTrace()}" 
                                  fill="none" stroke="#00ff00" stroke-width="2"/>
                        <!-- Brake trace -->
                        <polyline points="${generateBrakeTrace()}" 
                                  fill="none" stroke="#ff0000" stroke-width="2"/>
                        <!-- Grid lines -->
                        <line x1="0" y1="100" x2="800" y2="100" stroke="#333" stroke-width="1" stroke-dasharray="5,5"/>
                        <!-- Labels -->
                        <text x="10" y="20" fill="#00ff00" font-size="12">100% Throttle</text>
                        <text x="10" y="190" fill="#ff0000" font-size="12">100% Brake</text>
                    </svg>
                    <div style="font-size: 0.85em; opacity: 0.7; margin-top: 10px;">
                        Shows pedal application throughout lap. Overlap indicates trail braking technique
                    </div>
                </div>
            `;
        }
        
        function generateGForceChart(trackData) {
            return `
                <div style="background: #2a2a2a; padding: 20px; border-radius: 6px; height: 250px; position: relative;">
                    <div style="color: #eb0a1e; font-weight: bold; margin-bottom: 10px;">G-Force Analysis (Lateral & Longitudinal)</div>
                    <svg width="100%" height="200" viewBox="0 0 800 200">
                        <!-- Lateral G -->
                        <polyline points="${generateLateralGTrace()}" 
                                  fill="none" stroke="#ffaa00" stroke-width="2"/>
                        <!-- Longitudinal G -->
                        <polyline points="${generateLongitudinalGTrace()}" 
                                  fill="none" stroke="#00aaff" stroke-width="2"/>
                        <!-- Center line -->
                        <line x1="0" y1="100" x2="800" y2="100" stroke="#666" stroke-width="1"/>
                        <!-- Labels -->
                        <text x="10" y="20" fill="#ffaa00" font-size="12">Lateral G (Cornering)</text>
                        <text x="10" y="40" fill="#00aaff" font-size="12">Longitudinal G (Accel/Brake)</text>
                    </svg>
                    <div style="font-size: 0.85em; opacity: 0.7; margin-top: 10px;">
                        Orange = cornering forces, Blue = acceleration/braking forces
                    </div>
                </div>
            `;
        }
        
        function generateSpeedTrace() {
            let points = [];
            for (let i = 0; i <= 800; i += 10) {
                const y = 100 + Math.sin(i / 100) * 60 + Math.random() * 10;
                points.push(`${i},${y}`);
            }
            return points.join(' ');
        }
        
        function generateThrottleTrace() {
            let points = [];
            for (let i = 0; i <= 800; i += 10) {
                const y = 150 - Math.abs(Math.sin(i / 80)) * 100 + Math.random() * 10;
                points.push(`${i},${y}`);
            }
            return points.join(' ');
        }
        
        function generateBrakeTrace() {
            let points = [];
            for (let i = 0; i <= 800; i += 10) {
                const brake = Math.max(0, Math.sin(i / 80 + Math.PI)) * 80;
                const y = 150 + brake + Math.random() * 5;
                points.push(`${i},${y}`);
            }
            return points.join(' ');
        }
        
        function generateLateralGTrace() {
            let points = [];
            for (let i = 0; i <= 800; i += 10) {
                const y = 100 + Math.sin(i / 90) * 40 + Math.random() * 5;
                points.push(`${i},${y}`);
            }
            return points.join(' ');
        }
        
        function generateLongitudinalGTrace() {
            let points = [];
            for (let i = 0; i <= 800; i += 10) {
                const y = 100 + Math.cos(i / 70) * 35 + Math.random() * 5;
                points.push(`${i},${y}`);
            }
            return points.join(' ');
        }
        
        function generateTelemetryInsights(trackData, maxSpeed, avgThrottle, maxCorneringG) {
            let insights = '<div>';
            
            if (maxSpeed < 150) {
                insights += `
                    <div class="insight-card warning">
                        <div class="insight-title">‚ö†Ô∏è Top Speed Opportunity</div>
                        <div class="insight-detail">
                            Max speed of ${maxSpeed.toFixed(1)} mph suggests potential for improvement. 
                            Check gear usage and aerodynamic setup for optimization.
                        </div>
                    </div>
                `;
            }
            
            if (avgThrottle < 65) {
                insights += `
                    <div class="insight-card warning">
                        <div class="insight-title">üéÆ Throttle Application</div>
                        <div class="insight-detail">
                            Average throttle of ${avgThrottle.toFixed(1)}% indicates conservative driving. 
                            Work on earlier and more aggressive throttle application out of corners.
                        </div>
                    </div>
                `;
            }
            
            if (maxCorneringG < 1.6) {
                insights += `
                    <div class="insight-card warning">
                        <div class="insight-title">üåÄ Cornering Speed</div>
                        <div class="insight-detail">
                            Max cornering G of ${maxCorneringG.toFixed(2)}G suggests room for higher corner speeds. 
                            Focus on racing line optimization and building confidence.
                        </div>
                    </div>
                `;
            }
            
            if (maxSpeed >= 160 && avgThrottle >= 70 && maxCorneringG >= 1.7) {
                insights += `
                    <div class="insight-card positive">
                        <div class="insight-title">‚úÖ Excellent Telemetry Profile</div>
                        <div class="insight-detail">
                            Strong performance across all telemetry metrics. Focus on consistency 
                            and fine-tuning for marginal gains.
                        </div>
                    </div>
                `;
            }
            
            insights += '</div>';
            return insights;
        }
        
        function generateDetailedGearChart(gearUsage) {
            const totalTime = Object.values(gearUsage).reduce((a, b) => a + b, 0);
            
            let chart = '<div style="margin-bottom: 15px;">';
            
            Object.entries(gearUsage).forEach(([gear, percentage]) => {
                const gearNum = gear.replace('gear', '');
                const width = (percentage / totalTime) * 100;
                const color = getGearColor(parseInt(gearNum));
                
                chart += `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 60px; font-size: 0.9em;">Gear ${gearNum}:</div>
                        <div style="flex: 1; background: #333; height: 20px; border-radius: 10px; overflow: hidden; margin: 0 10px;">
                            <div style="background: ${color}; width: ${width}%; height: 100%; transition: width 0.3s;"></div>
                        </div>
                        <div style="width: 50px; font-size: 0.9em; text-align: right;">${percentage}%</div>
                    </div>
                `;
            });
            
            chart += '</div>';
            return chart;
        }
        
        function getGearColor(gear) {
            const colors = {
                1: '#ff4444', 2: '#ff8844', 3: '#ffaa44', 
                4: '#ffdd44', 5: '#88ff44', 6: '#44ff88'
            };
            return colors[gear] || '#666666';
        }
        
        function calculateGearScore(trackData) {
            let score = 0;
            
            // Average gear score (0-40 points)
            const avgGearScore = Math.min(40, (trackData.avgGear / 6.0) * 40);
            score += avgGearScore;
            
            // Shift frequency score (0-30 points) - fewer shifts is better
            const shiftScore = Math.max(0, 30 - ((trackData.gearShifts - 20) * 2));
            score += Math.min(30, shiftScore);
            
            // Gear range utilization (0-30 points)
            const rangeScore = (trackData.maxGear / 6.0) * 30;
            score += rangeScore;
            
            return Math.round(score);
        }
        
        function getGearImprovementPriority(trackData) {
            const issues = [];
            
            if (trackData.avgGear < 4.0) {
                issues.push("1. <strong>Increase average gear usage</strong> - Focus on using higher gears");
            }
            
            if (trackData.gearShifts > 35) {
                issues.push("2. <strong>Reduce gear changes</strong> - Plan shifts more efficiently");
            }
            
            const totalTime = Object.values(trackData.gearUsage).reduce((a, b) => a + b, 0);
            const gear6Percent = (trackData.gearUsage.gear6 / totalTime) * 100;
            
            if (gear6Percent < 5 && selectedTrack !== 'BMP') {
                issues.push("3. <strong>Utilize top gear more</strong> - Find opportunities for 6th gear");
            }
            
            if (issues.length === 0) {
                return "Gear usage is well optimized. Focus on fine-tuning shift timing and maintaining consistency.";
            }
            
            return issues.join('<br>');
        }
        
        function generateGearRecommendations(trackData) {
            let recommendations = '<div>';
            
            // Analyze gear usage patterns and provide specific coaching
            const totalTime = Object.values(trackData.gearUsage).reduce((a, b) => a + b, 0);
            const gear2Percent = (trackData.gearUsage.gear2 / totalTime) * 100;
            const gear6Percent = (trackData.gearUsage.gear6 / totalTime) * 100;
            
            // Low gear usage analysis
            if (trackData.avgGear < 4.0) {
                recommendations += `
                    <div class="insight-card critical">
                        <div class="insight-title">üö® Low Gear Usage Pattern</div>
                        <div class="insight-detail">
                            <strong>Issue:</strong> Average gear of ${trackData.avgGear} indicates staying in low gears too long.<br>
                            <strong>Impact:</strong> Reduced top speed and slower acceleration out of corners.<br>
                            <strong>How to improve:</strong><br>
                            ‚Ä¢ Practice earlier upshifts after corner exit<br>
                            ‚Ä¢ Use engine braking instead of staying in low gears<br>
                            ‚Ä¢ Focus on smooth throttle application to enable higher gears<br>
                            ‚Ä¢ Target: Increase average gear to 4.5+ for this track
                        </div>
                    </div>
                `;
            }
            
            // Excessive shifting analysis
            if (trackData.gearShifts > 35) {
                recommendations += `
                    <div class="insight-card warning">
                        <div class="insight-title">‚ö†Ô∏è Excessive Gear Changes</div>
                        <div class="insight-detail">
                            <strong>Issue:</strong> ${trackData.gearShifts} shifts per lap is above optimal (target: 25-30).<br>
                            <strong>Impact:</strong> Disrupted car balance and lost momentum.<br>
                            <strong>How to improve:</strong><br>
                            ‚Ä¢ Plan gear changes before corners, not during<br>
                            ‚Ä¢ Use engine braking zones more effectively<br>
                            ‚Ä¢ Practice "skip shifting" where appropriate (3rd to 5th)<br>
                            ‚Ä¢ Focus on maintaining gear longer through corner sequences<br>
                            ‚Ä¢ Target: Reduce to under 30 shifts per lap
                        </div>
                    </div>
                `;
            }
            
            // Top gear utilization
            if (gear6Percent < 5 && selectedTrack !== 'BMP') {
                recommendations += `
                    <div class="insight-card warning">
                        <div class="insight-title">‚öôÔ∏è Underutilized Top Gear</div>
                        <div class="insight-detail">
                            <strong>Issue:</strong> Only ${gear6Percent.toFixed(1)}% time in 6th gear on a track with straights.<br>
                            <strong>Impact:</strong> Missing top speed potential and fuel efficiency.<br>
                            <strong>How to improve:</strong><br>
                            ‚Ä¢ Identify all straight sections where 6th gear is possible<br>
                            ‚Ä¢ Practice earlier upshifts on main straights<br>
                            ‚Ä¢ Use 6th gear even for short periods to maximize speed<br>
                            ‚Ä¢ Check if setup allows for 6th gear usage<br>
                            ‚Ä¢ Target: 10-15% time in 6th gear for high-speed tracks
                        </div>
                    </div>
                `;
            }
            
            // Second gear overuse
            if (gear2Percent > 20) {
                recommendations += `
                    <div class="insight-card critical">
                        <div class="insight-title">üö® Excessive Low Gear Usage</div>
                        <div class="insight-detail">
                            <strong>Issue:</strong> ${gear2Percent.toFixed(1)}% time in 2nd gear is too high.<br>
                            <strong>Impact:</strong> Poor acceleration and reduced corner exit speed.<br>
                            <strong>How to improve:</strong><br>
                            ‚Ä¢ Work on corner entry speed to avoid dropping to 2nd<br>
                            ‚Ä¢ Practice trail braking to maintain higher corner speeds<br>
                            ‚Ä¢ Focus on racing line to carry more speed through corners<br>
                            ‚Ä¢ Use 3rd gear with more throttle control instead of 2nd<br>
                            ‚Ä¢ Target: Reduce 2nd gear usage to under 15%
                        </div>
                    </div>
                `;
            }
            
            // Optimal gear usage praise
            if (trackData.avgGear >= 4.5 && trackData.gearShifts <= 30 && gear6Percent >= 10) {
                recommendations += `
                    <div class="insight-card positive">
                        <div class="insight-title">‚úÖ Excellent Gear Management</div>
                        <div class="insight-detail">
                            <strong>Strengths:</strong><br>
                            ‚Ä¢ Optimal average gear usage (${trackData.avgGear})<br>
                            ‚Ä¢ Efficient shift frequency (${trackData.gearShifts} shifts/lap)<br>
                            ‚Ä¢ Good top gear utilization (${gear6Percent.toFixed(1)}%)<br>
                            <strong>Maintain:</strong> Continue current gear selection strategy<br>
                            <strong>Fine-tune:</strong> Look for micro-optimizations in gear timing
                        </div>
                    </div>
                `;
            }
            
            // Track-specific gear advice
            recommendations += generateTrackSpecificGearAdvice(trackData, selectedTrack);
            
            recommendations += '</div>';
            return recommendations;
        }
        
        function generateTrackSpecificGearAdvice(trackData, trackId) {
            const trackGearAdvice = {
                'BMP': {
                    title: 'Barber Motorsports Park - Technical Gear Strategy',
                    advice: `
                        <strong>Track characteristics:</strong> Technical with elevation changes<br>
                        <strong>Key gear zones:</strong><br>
                        ‚Ä¢ Turn 5: Use 3rd gear, early throttle for uphill exit<br>
                        ‚Ä¢ Sector 2: Focus on 4th-5th gear flow through esses<br>
                        ‚Ä¢ Back straight: Brief 6th gear opportunity<br>
                        <strong>Technique:</strong> Prioritize smooth gear changes over speed
                    `
                },
                'COTA': {
                    title: 'COTA - Mixed Speed Gear Management',
                    advice: `
                        <strong>Track characteristics:</strong> Mix of high-speed and technical sections<br>
                        <strong>Key gear zones:</strong><br>
                        ‚Ä¢ Turn 1: 2nd gear entry, quick progression to 6th on back straight<br>
                        ‚Ä¢ Esses (S2): Maintain 4th-5th gear flow<br>
                        ‚Ä¢ Stadium section: 3rd gear focus with smooth transitions<br>
                        <strong>Technique:</strong> Plan gear changes for long straights
                    `
                },
                'VIR': {
                    title: 'VIR - High-Speed Gear Optimization',
                    advice: `
                        <strong>Track characteristics:</strong> High-speed with flowing sections<br>
                        <strong>Key gear zones:</strong><br>
                        ‚Ä¢ Uphill esses: Maintain momentum with 4th-5th gear<br>
                        ‚Ä¢ Main straight: Maximize 6th gear usage<br>
                        ‚Ä¢ Oak Tree: 3rd gear commitment through complex<br>
                        <strong>Technique:</strong> Use higher gears to maintain flow
                    `
                },
                'INDY': {
                    title: 'Indianapolis - Oval Gear Strategy',
                    advice: `
                        <strong>Track characteristics:</strong> High-speed oval racing<br>
                        <strong>Key gear zones:</strong><br>
                        ‚Ä¢ Straights: Maximum 6th gear usage (70%+ target)<br>
                        ‚Ä¢ Turns: 5th gear with minimal shifting<br>
                        ‚Ä¢ Pit entry/exit: Plan gear changes for traffic<br>
                        <strong>Technique:</strong> Minimize shifts, maximize top gear time
                    `
                }
            };
            
            const advice = trackGearAdvice[trackId];
            if (!advice) return '';
            
            return `
                <div class="insight-card">
                    <div class="insight-title">üèÅ ${advice.title}</div>
                    <div class="insight-detail">${advice.advice}</div>
                </div>
            `;
        }
        
        function generateAdvancedInsights(driver, trackData, trackConfig) {
            return `
                <div class="insight-card positive">
                    <div class="insight-title">‚úÖ Strengths</div>
                    <div class="insight-detail">
                        ‚Ä¢ Consistent sector 1 performance<br>
                        ‚Ä¢ Good gear management<br>
                        ‚Ä¢ Smooth throttle application
                    </div>
                </div>
                
                <div class="insight-card warning">
                    <div class="insight-title">‚ö†Ô∏è Areas for Improvement</div>
                    <div class="insight-detail">
                        ‚Ä¢ Losing 0.3s in sector 3<br>
                        ‚Ä¢ Late on throttle in tight corners<br>
                        ‚Ä¢ Inconsistent braking points
                    </div>
                </div>
                
                <div class="insight-card">
                    <div class="insight-title">üéØ Action Items</div>
                    <div class="insight-detail">
                        ‚Ä¢ Practice trail braking technique<br>
                        ‚Ä¢ Work on corner exit optimization<br>
                        ‚Ä¢ Focus on sector 3 consistency
                    </div>
                </div>
            `;
        }
        
        function loadTrackImage(trackId) {
            const trackImage = document.getElementById('trackImage');
            if (trackImage && typeof TRACK_IMAGES !== 'undefined' && TRACK_IMAGES[trackId]) {
                trackImage.src = TRACK_IMAGES[trackId].image_url;
                trackImage.alt = `${trackConfigs[trackId].name} Track Layout`;
            }
        }
        
        function renderComparisonAnalysis(driver, trackData, trackConfig) {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="panel full-width">
                    <h2>üìä Driver Comparison at ${trackConfig.name}</h2>
                    <p style="margin-bottom: 20px;">Comparing ${driver.name} performance against all drivers</p>
                    
                    <div class="insight-card">
                        <div class="insight-title">üèÅ Competitive Position</div>
                        <div class="insight-detail">
                            <strong>Current Position:</strong> P${trackData.position} of 5 drivers<br>
                            <strong>Gap to Leader:</strong> ${(parseFloat(trackData.bestLap.split(':')[1]) - 83.234).toFixed(3)}s<br>
                            <strong>Status:</strong> ${driver.status.toUpperCase()}<br><br>
                            <strong>Performance vs Field:</strong><br>
                            ‚Ä¢ Speed: ${trackData.avgSpeed > 140 ? 'Above average' : 'Below average'}<br>
                            ‚Ä¢ Consistency: ${trackData.consistency > 90 ? 'Excellent' : 'Good'}<br>
                            ‚Ä¢ Gear Usage: ${trackData.avgGear > 4.5 ? 'Optimal' : 'Needs improvement'}
                        </div>
                    </div>
                    
                    <div class="insight-card ${trackData.position <= 3 ? 'positive' : 'warning'}">
                        <div class="insight-title">üí° Competitive Analysis</div>
                        <div class="insight-detail">
                            ${trackData.position === 1 ? 
                                'Leading the field! Focus on maintaining consistency and defending position.' :
                                trackData.position <= 3 ?
                                `Strong podium position. Focus on sectors where you're losing time to move up.` :
                                `Mid-field position. Significant improvement potential through focused practice on weak sectors.`
                            }
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderHistoricalAnalysis(driver, trackData, trackConfig) {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="panel full-width">
                    <h2>üìà Historical Performance Trends</h2>
                    <p style="margin-bottom: 20px;">Performance tracking for ${driver.name} at ${trackConfig.name}</p>
                    
                    <div class="insight-card">
                        <div class="insight-title">üìä Session Progress</div>
                        <div class="insight-detail">
                            <strong>Current Session:</strong> Best lap ${trackData.bestLap}<br>
                            <strong>Improvement Trend:</strong> -0.234s vs previous session<br>
                            <strong>Consistency Trend:</strong> ${trackData.consistency}% (‚Üë 2% improvement)<br>
                            <strong>Speed Trend:</strong> ${trackData.avgSpeed} mph (‚Üë 2.1 mph improvement)
                        </div>
                    </div>
                    
                    <div class="insight-card positive">
                        <div class="insight-title">‚úÖ Improvement Areas</div>
                        <div class="insight-detail">
                            ‚Ä¢ Lap times improving consistently<br>
                            ‚Ä¢ Gear usage optimization showing results<br>
                            ‚Ä¢ Consistency metrics trending upward<br>
                            ‚Ä¢ Speed through technical sections improving
                        </div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-title">üéØ Next Session Goals</div>
                        <div class="insight-detail">
                            ‚Ä¢ Target lap time: ${(parseFloat(trackData.bestLap.split(':')[1]) - 0.5).toFixed(3)}s<br>
                            ‚Ä¢ Focus on sector ${trackData.sectors.indexOf(Math.max(...trackData.sectors)) + 1} improvement<br>
                            ‚Ä¢ Maintain consistency above ${trackData.consistency}%<br>
                            ‚Ä¢ Continue gear optimization work
                        </div>
                    </div>
                </div>
            `;
        }
        
        function exportData() {
            alert('Export functionality would generate detailed PDF report or CSV data export');
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDetailedDashboard);
    </script>
</body>
</html>